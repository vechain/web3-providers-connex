'use strict';

import 'mocha';
import { expect, assert } from 'chai';
import { Framework } from '@vechain/connex-framework';
import { Driver, SimpleNet, SimpleWallet } from '@vechain/connex-driver';
import Web3 from 'web3';

import { ProviderWeb3, ErrMsg } from '../../src/index';
import { urls } from '../settings';

describe('Testing getCode', () => {
	const net = new SimpleNet(urls.mainnet);
	const wallet = new SimpleWallet();

	let driver: Driver;
	let web3: any;

	before(async () => {
		try {
			driver = await Driver.connect(net, wallet);
			web3 = new Web3(new ProviderWeb3({ connex: new Framework(driver) }));
		} catch (err: any) {
			assert.fail('Initialization failed: ' + err);
		}
	})

	after(() => {
		driver?.close();
	})

	const addr = '0x9e68D6c7daf2e010D8B8Ee157D81DE143a7C68EF';

	it('option not supported', async () => {
		const opt = 'earliest';
		const expectedErr = ErrMsg.MethodParamNotSupported('eth_getCode', 2);
		try {
			await web3.eth.getCode(addr, opt);
			assert.fail();
		} catch (err: any) {
			expect(err.message).to.eql(expectedErr);
		}
	})

	it('with code', async () => {
		const expectedCode: string = '0x6080604052600436106103c25760003560e01c8063715018a6116101f257806395e4d5fd1161010d578063cdd45a48116100a0578063de9e69151161006f578063de9e691514610c24578063ef71f54114610c44578063f2fde38b14610c64578063f3c4b4a214610c8457600080fd5b8063cdd45a4814610ba1578063d56d229d14610bc1578063d8d6fdf414610be1578063dd5702cd14610bf757600080fd5b8063bdeddb2d116100dc578063bdeddb2d14610b11578063c128b23114610b31578063c815729d14610b51578063cd245a8714610b7157600080fd5b806395e4d5fd14610a765780639ba6a78514610aae578063aba81d9f14610ac4578063b33e156e14610af157600080fd5b80638456cb591161018557806388b10c751161015457806388b10c75146109bf5780638a72ea6a146109df5780638da5cb5b14610a385780639365861014610a5657600080fd5b80638456cb5914610954578063853d58fe146109695780638610f0451461098957806387606789146109a957600080fd5b80637c0d9af5116101c15780637c0d9af5146108e65780637c3ae2be1461091357806380901ecd1461092957806383b5ff8b1461093e57600080fd5b8063715018a614610864578063755201fd14610879578063757de57314610899578063780f1729146108b957600080fd5b8063305a67a8116102e257806354463c6d1161027557806361cf48631161024457806361cf4863146107d65780636825e864146107f657806369d037381461082e5780636a1b7ecc1461084e57600080fd5b806354463c6d1461074a57806356a971981461076a5780635c4e6e491461078a5780635c975abb146107b757600080fd5b80633ccfd60b116102b15780633ccfd60b146106ed5780633f4ba83a146107025780634884f459146107175780634e5bb35a1461072a57600080fd5b8063305a67a81461065a5780633a9040341461067a5780633acc42b8146106a75780633b8070c9146106d757600080fd5b806317e96ec61161035a57806326bb9c971161032957806326bb9c97146105cd57806326ec0fbe146105ed57806328be3a761461061a5780632900c4631461063a57600080fd5b806317e96ec6146105015780631ad2e0ad146105145780631f4871f11461056857806321ab06bb146105a057600080fd5b806305b7cdd31161039657806305b7cdd31461047c5780630a9ef34c1461048f57806311a5f0ac146104b4578063131dbd09146104e157600080fd5b80620cbb7f146103c7578063045fb3e9146103fd57806305251a61146104225780630562b9f71461045a575b600080fd5b3480156103d357600080fd5b506103e76103e2366004614a59565b610c9a565b6040516103f49190614c0f565b60405180910390f35b34801561040957600080fd5b50600a546104149081565b6040519081526020016103f4565b34801561042e57600080fd5b5061041461043d366004614a2e565b601760209081526000928352604080842090915290825290205481565b34801561046657600080fd5b5061047a610475366004614b4d565b610e73565b005b61047a61048a366004614b7d565b610f34565b34801561049b57600080fd5b506104a4611424565b60405190151581526020016103f4565b3480156104c057600080fd5b506104146104cf366004614b4d565b600f6020526000908152604090205481565b3480156104ed57600080fd5b5061047a6104fc366004614b4d565b6114cf565b61047a61050f366004614b9e565b6114fe565b34801561052057600080fd5b5061053461052f366004614b4d565b6117bd565b604080519586526020860194909452928401919091526001600160a01b03908116606084015216608082015260a0016103f4565b34801561057457600080fd5b50610414610583366004614a2e565b600e60209081526000928352604080842090915290825290205481565b3480156105ac57600080fd5b506104146105bb3660046149f6565b60166020526000908152604090205481565b3480156105d957600080fd5b5061047a6105e8366004614b4d565b611895565b3480156105f957600080fd5b50610414610608366004614b4d565b60126020526000908152604090205481565b34801561062657600080fd5b5061047a610635366004614b4d565b6118c4565b34801561064657600080fd5b5061047a610655366004614a8d565b6118f3565b34801561066657600080fd5b5061047a610675366004614b4d565b6119a0565b34801561068657600080fd5b50610414610695366004614b4d565b601b6020526000908152604090205481565b3480156106b357600080fd5b506104a46106c2366004614b4d565b601f6020526000908152604090205460ff1681565b3480156106e357600080fd5b50610414600d5481565b3480156106f957600080fd5b5061047a611c1d565b34801561070e57600080fd5b5061047a611c83565b61047a610725366004614b4d565b611cb7565b34801561073657600080fd5b5061047a610745366004614b4d565b612139565b34801561075657600080fd5b506103e7610765366004614a59565b6122be565b34801561077657600080fd5b5061047a610785366004614b4d565b6123d8565b34801561079657600080fd5b506104146107a53660046149f6565b60196020526000908152604090205481565b3480156107c357600080fd5b50600154600160a01b900460ff166104a4565b3480156107e257600080fd5b506105346107f1366004614b4d565b612407565b34801561080257600080fd5b50600354610816906001600160a01b031681565b6040516001600160a01b0390911681526020016103f4565b34801561083a57600080fd5b5061047a6108493660046149f6565b612455565b34801561085a57600080fd5b50610414600b5481565b34801561087057600080fd5b5061047a612507565b34801561088557600080fd5b506103e7610894366004614a59565b61253b565b3480156108a557600080fd5b5061047a6108b4366004614b4d565b612655565b3480156108c557600080fd5b506104146108d4366004614b4d565b601e6020526000908152604090205481565b3480156108f257600080fd5b506104146109013660046149f6565b60106020526000908152604090205481565b34801561091f57600080fd5b5061041460155481565b34801561093557600080fd5b50610414612684565b34801561094a57600080fd5b5061041460045481565b34801561096057600080fd5b5061047a6126b8565b34801561097557600080fd5b5061047a610984366004614b7d565b6126ea565b34801561099557600080fd5b5061047a6109a4366004614b4d565b61297e565b3480156109b557600080fd5b5061041460145481565b3480156109cb57600080fd5b5061047a6109da366004614b4d565b612b86565b3480156109eb57600080fd5b506109ff6109fa366004614b4d565b612d82565b6040805196875260208701959095529385019290925260608401526001600160a01b0390811660808401521660a082015260c0016103f4565b348015610a4457600080fd5b506001546001600160a01b0316610816565b348015610a6257600080fd5b506109ff610a71366004614b4d565b612dd5565b348015610a8257600080fd5b50610414610a91366004614a2e565b601a60209081526000928352604080842090915290825290205481565b348015610aba57600080fd5b50610414600c5481565b348015610ad057600080fd5b50610414610adf366004614b4d565b60186020526000908152604090205481565b348015610afd57600080fd5b5061047a610b0c366004614b4d565b612eef565b348015610b1d57600080fd5b5061047a610b2c366004614b4d565b612f1e565b348015610b3d57600080fd5b506103e7610b4c366004614b7d565b613118565b348015610b5d57600080fd5b5061047a610b6c366004614b4d565b613229565b348015610b7d57600080fd5b506104a4610b8c366004614b4d565b60136020526000908152604090205460ff1681565b348015610bad57600080fd5b506103e7610bbc366004614a59565b6135c2565b348015610bcd57600080fd5b50600254610816906001600160a01b031681565b348015610bed57600080fd5b5061041460065481565b348015610c0357600080fd5b50610414610c123660046149f6565b601c6020526000908152604090205481565b348015610c3057600080fd5b5061047a610c3f366004614b4d565b6136dc565b348015610c5057600080fd5b5061047a610c5f366004614b4d565b61374f565b348015610c7057600080fd5b5061047a610c7f3660046149f6565b61377e565b348015610c9057600080fd5b5061041460055481565b6002546040516370a0823160e01b81526001600160a01b0385811660048301526060926000929116906370a082319060240160206040518083038186803b158015610ce457600080fd5b505afa158015610cf8573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610d1c9190614b65565b90506000610d2b858584613816565b905060008167ffffffffffffffff811115610d5657634e487b7160e01b600052604160045260246000fd5b604051908082528060200260200182016040528015610d7f578160200160208202803683370190505b5090506000865b610d908489614d7d565b811015610e6657600254604051632f745c5960e01b81526001600160a01b038b811660048301526024820184905290911690632f745c599060440160206040518083038186803b158015610de357600080fd5b505afa158015610df7573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e1b9190614b65565b838381518110610e3b57634e487b7160e01b600052603260045260246000fd5b602090810291909101015281610e5081614deb565b9250508080610e5e90614deb565b915050610d86565b5090979650505050505050565b6001546001600160a01b03163314610ea65760405162461bcd60e51b8152600401610e9d90614c9f565b60405180910390fd5b47811115610ef65760405162461bcd60e51b815260206004820152601c60248201527f4e6f7420656e6f756768206d6f6e657920696e207468652062616e6b000000006044820152606401610e9d565b6001546040516001600160a01b039091169082156108fc029083906000818181858888f19350505050158015610f30573d6000803e3d6000fd5b5050565b60026000541415610f575760405162461bcd60e51b8152600401610e9d90614cd4565b6002600055600154600160a01b900460ff1615610f865760405162461bcd60e51b8152600401610e9d90614c75565b6000610f91836138c9565b90506001600160a01b038116331415610ff85760405162461bcd60e51b8152602060048201526024808201527f43616e6e6f74206d616b65206f6666657220666f7220796f7572206f776e207460448201526337b5b2b760e11b6064820152608401610e9d565b6015548210156110595760405162461bcd60e51b815260206004820152602660248201527f507269636520736d616c6c6572207468616e206d696e696d756d206f6666657260448201526520707269636560d01b6064820152608401610e9d565b6014546110669083614d7d565b34146110ac5760405162461bcd60e51b8152602060048201526015602482015274139bdd08195b9bdd59da081b5bdb995e481cd95b9d605a1b6044820152606401610e9d565b6001600160a01b03811660009081526016602052604090205482101561112f5760405162461bcd60e51b815260206004820152603260248201527f507269636520736d616c6c6572207468616e206d696e696d756d206f6666657260448201527120707269636520666f72206164647265737360701b6064820152608401610e9d565b6000838152601f602052604090205460ff16156113b5576000838152601e6020526040902054601d8054909190811061117857634e487b7160e01b600052603260045260246000fd5b90600052602060002090600602016001015482116111e85760405162461bcd60e51b815260206004820152602760248201527f50726963652068617320746f20626520686967686572207468616e2068696768604482015266195cdd08189a5960ca1b6064820152608401610e9d565b6000838152601e6020526040902054601d8054909190811061121a57634e487b7160e01b600052603260045260246000fd5b60009182526020909120600690910201600401546001600160a01b03163314156112955760405162461bcd60e51b815260206004820152602660248201527f4f6666657220616c7265616479207375626d697474656420666f722074686973604482015265103a37b5b2b760d11b6064820152608401610e9d565b6000838152601e6020526040812054601d805490919081106112c757634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a08201529050611335846139b7565b61134781608001518260200151613af7565b508060a001516001600160a01b0316336001600160a01b0316857f223f93e5d40fb01f51f8a6dfe128dca9f796ac5b13ab684d8db1799f4b84f9d08460200151876014546040516113ab939291909283526020830191909152604082015260600190565b60405180910390a4505b6113c183338385613be9565b806001600160a01b0316336001600160a01b0316847f9775d11548e3818568299a61c610b734d320daf7d3fbfbb6075724f7d52c8f9f85601454604051611412929190918252602082015260400190565b60405180910390a45050600160005550565b6001546000906001600160a01b031633146114515760405162461bcd60e51b8152600401610e9d90614c9f565b60075480156114c757600060078190556001546040516001600160a01b039091169083908381818185875af1925050503d80600081146114ad576040519150601f19603f3d011682016040523d82523d6000602084013e6114b2565b606091505b50509050806114c5575060075550600090565b505b600191505090565b6001546001600160a01b031633146114f95760405162461bcd60e51b8152600401610e9d90614c9f565b600b55565b600260005414156115215760405162461bcd60e51b8152600401610e9d90614cd4565b6002600055600154600160a01b900460ff16156115505760405162461bcd60e51b8152600401610e9d90614c75565b6002546040516331a9108f60e11b815260048101859052849130916001600160a01b0390911690636352211e9060240160206040518083038186803b15801561159857600080fd5b505afa1580156115ac573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906115d09190614a12565b6001600160a01b0316141580156115f6575060008181526013602052604090205460ff16155b6116395760405162461bcd60e51b8152602060048201526014602482015273151bdad95b88185b1c9958591e481b1a5cdd195960621b6044820152606401610e9d565b8333611644826138c9565b6001600160a01b0316146116865760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610e9d565b600b543410156116d05760405162461bcd60e51b8152602060048201526015602482015274139bdd08195b9bdd59da08199d5b991cc81cd95b9d605a1b6044820152606401610e9d565b600c548410156116f25760405162461bcd60e51b8152600401610e9d90614d35565b336001600160a01b03841614156117425760405162461bcd60e51b81526020600482015260146024820152732634b9ba34b733903337b9103cb7bab939b2b63360611b6044820152606401610e9d565b61174e33848787613e16565b6117583386613fdf565b826001600160a01b0316336001600160a01b0316867f835b2770f2f0dc2211fcd5e608665a1805a5b479d6e1e5195384393b6172f12d87600b546040516117a9929190918252602082015260400190565b60405180910390a450506001600055505050565b600081815260136020526040812054819081908190819060ff166117f35760405162461bcd60e51b8152600401610e9d90614d0b565b60008681526012602052604081205460118054909190811061182557634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059390930290910180548084526001820154948401859052600282015492840183905260038201546001600160a01b03908116606086018190526004909301541660809094018490529b939a509098509650945092505050565b6001546001600160a01b031633146118bf5760405162461bcd60e51b8152600401610e9d90614c9f565b600555565b6001546001600160a01b031633146118ee5760405162461bcd60e51b8152600401610e9d90614c9f565b600d55565b600d54815111156119525760405162461bcd60e51b8152602060048201526024808201527f596f752063616e6e6f742063616e63656c2074686174206d616e79206c697374604482015263696e677360e01b6064820152608401610e9d565b60005b8151811015610f305761198e82828151811061198157634e487b7160e01b600052603260045260246000fd5b60200260200101516119a0565b8061199881614deb565b915050611955565b600260005414156119c35760405162461bcd60e51b8152600401610e9d90614cd4565b60026000819055546040516331a9108f60e11b815260048101839052829130916001600160a01b0390911690636352211e9060240160206040518083038186803b158015611a1057600080fd5b505afa158015611a24573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611a489190614a12565b6001600160a01b0316148015611a6c575060008181526013602052604090205460ff165b611a885760405162461bcd60e51b8152600401610e9d90614d0b565b6000828152601260205260409020546011805484923392918110611abc57634e487b7160e01b600052603260045260246000fd5b60009182526020909120600360059092020101546001600160a01b031614611b1b5760405162461bcd60e51b81526020600482015260126024820152712737ba103634b9ba34b7339030baba3437b960711b6044820152606401610e9d565b600083815260126020526040812054601180549091908110611b4d57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059093029091018054835260018101549383019390935260028301549082015260038201546001600160a01b03908116606083015260049092015490911660808201529050611bb184614050565b611bbf816060015185614059565b6060810151602080830151600b5460408051928352928201526000926001600160a01b03169187917f96458772c85f66d5a1d51356692a8babb9fb01d27c5504fc7b9f685b3d9c31f6910160405180910390a4505060016000555050565b6001546001600160a01b03163314611c475760405162461bcd60e51b8152600401610e9d90614c9f565b6001546040516001600160a01b03909116904780156108fc02916000818181858888f19350505050158015611c80573d6000803e3d6000fd5b50565b6001546001600160a01b03163314611cad5760405162461bcd60e51b8152600401610e9d90614c9f565b611cb5614098565b565b60026000541415611cda5760405162461bcd60e51b8152600401610e9d90614cd4565b6002600055600154600160a01b900460ff1615611d095760405162461bcd60e51b8152600401610e9d90614c75565b6002546040516331a9108f60e11b815260048101839052829130916001600160a01b0390911690636352211e9060240160206040518083038186803b158015611d5157600080fd5b505afa158015611d65573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611d899190614a12565b6001600160a01b0316148015611dad575060008181526013602052604090205460ff165b611dc95760405162461bcd60e51b8152600401610e9d90614d0b565b600082815260126020526040812054601180549091908110611dfb57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059093029091018054835260018101549383019390935260028301549082015260038201546001600160a01b03908116606083018190526004909301541660808201529150331415611ea55760405162461bcd60e51b815260206004820152601860248201527f43616e6e6f742062757920796f7572206f776e206974656d00000000000000006044820152606401610e9d565b8060200151341015611ef15760405162461bcd60e51b8152602060048201526015602482015274139bdd08195b9bdd59da08199d5b991cc81cd95b9d605a1b6044820152606401610e9d565b60808101516001600160a01b031615611f695780608001516001600160a01b0316336001600160a01b031614611f695760405162461bcd60e51b815260206004820152601860248201527f596f752063616e6e6f74206275792074686973206974656d00000000000000006044820152606401610e9d565b611f7283614050565b6000838152601f602052604090205460ff161561203e576000838152601e6020526040812054601d80549091908110611fbb57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a0820152905061202984614135565b61203b81608001518260200151613af7565b50505b6000806000612050846020015161413e565b9250925092506000818385876020015161206a9190614dd4565b6120749190614dd4565b61207e9190614dd4565b905061208e856060015182613af7565b50612098836141a1565b6120a1826141db565b83600760008282546120b39190614d7d565b909155506120c390503388614059565b606085810151602080880151600b546040805192835292820152808201889052928301869052608083018590525133926001600160a01b03909216918a917fc98f1cedf45efce0ed2092f023509df0de77a95270af296b406b0db2ef8b28349181900360a00190a4505060016000555050505050565b6001546001600160a01b031633146121635760405162461bcd60e51b8152600401610e9d90614c9f565b6000818152601f6020526040902054819060ff166121935760405162461bcd60e51b8152600401610e9d90614c47565b6000828152601e6020526040812054601d805490919081106121c557634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a08201529050612233836139b7565b61225481608001518260400151836020015161224f9190614d7d565b614215565b8060a001516001600160a01b031681608001516001600160a01b0316847f892b9b4a7961cc6223c6a4519e1a71f6b85b006e1fb3491f5fc95ec44c143b8a84602001516014546040516122b1929190918252602082015260400190565b60405180910390a4505050565b6001600160a01b0383166000908152601c60205260408120546060916122e5858584613816565b905060008167ffffffffffffffff81111561231057634e487b7160e01b600052604160045260246000fd5b604051908082528060200260200182016040528015612339578160200160208202803683370190505b5090506000865b61234a8489614d7d565b811015610e66576001600160a01b0389166000908152601a60209081526040808320848452825280832054808452601f9092529091205460ff16156123b757808484815181106123aa57634e487b7160e01b600052603260045260246000fd5b6020026020010181815250505b826123c181614deb565b9350505080806123d090614deb565b915050612340565b6001546001600160a01b031633146124025760405162461bcd60e51b8152600401610e9d90614c9f565b601455565b6011818154811061241757600080fd5b600091825260209091206005909102018054600182015460028301546003840154600490940154929450909290916001600160a01b03918216911685565b6001546001600160a01b0316331461247f5760405162461bcd60e51b8152600401610e9d90614c9f565b6001600160a01b038116158015906124a057506001600160a01b0381163014155b6124e55760405162461bcd60e51b815260206004820152601660248201527515dc9bdb99c81859191c995cdcc81c1c9bdd9a59195960521b6044820152606401610e9d565b600280546001600160a01b0319166001600160a01b0392909216919091179055565b6001546001600160a01b031633146125315760405162461bcd60e51b8152600401610e9d90614c9f565b611cb56000614250565b6001600160a01b038316600090815260106020526040812054606091612562858584613816565b905060008167ffffffffffffffff81111561258d57634e487b7160e01b600052604160045260246000fd5b6040519080825280602002602001820160405280156125b6578160200160208202803683370190505b5090506000865b6125c78489614d7d565b811015610e66576001600160a01b0389166000908152600e6020908152604080832084845282528083205480845260139092529091205460ff1615612634578084848151811061262757634e487b7160e01b600052603260045260246000fd5b6020026020010181815250505b8261263e81614deb565b93505050808061264d90614deb565b9150506125bd565b6001546001600160a01b0316331461267f5760405162461bcd60e51b8152600401610e9d90614c9f565b600455565b6001546000906001600160a01b031633146126b15760405162461bcd60e51b8152600401610e9d90614c9f565b5060075490565b6001546001600160a01b031633146126e25760405162461bcd60e51b8152600401610e9d90614c9f565b611cb56142a2565b600154600160a01b900460ff16156127145760405162461bcd60e51b8152600401610e9d90614c75565b6002546040516331a9108f60e11b815260048101849052839130916001600160a01b0390911690636352211e9060240160206040518083038186803b15801561275c57600080fd5b505afa158015612770573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906127949190614a12565b6001600160a01b03161480156127b8575060008181526013602052604090205460ff165b6127d45760405162461bcd60e51b8152600401610e9d90614d0b565b600083815260126020526040902054601180548592339291811061280857634e487b7160e01b600052603260045260246000fd5b60009182526020909120600360059092020101546001600160a01b0316146128675760405162461bcd60e51b81526020600482015260126024820152712737ba103634b9ba34b7339030baba3437b960711b6044820152606401610e9d565b600c548310156128895760405162461bcd60e51b8152600401610e9d90614d35565b6000848152601260205260408120546011805490919081106128bb57634e487b7160e01b600052603260045260246000fd5b90600052602060002090600502019050600081600101549050848114156129185760405162461bcd60e51b8152602060048201526011602482015270141c9a58d9481b9bdd0818da185b99d959607a1b6044820152606401610e9d565b600182018590556003820154600b54604080518481526020810189905280820192909252516000926001600160a01b03169189917f9040b9d995c0b57f35f42a48497b75cdff3e9003e2457d0e33e3b54f432f2c929181900360600190a4505050505050565b6000818152601f6020526040902054819060ff166129ae5760405162461bcd60e51b8152600401610e9d90614c47565b6000828152601e6020526040902054601d8054849233929181106129e257634e487b7160e01b600052603260045260246000fd5b60009182526020909120600460069092020101546001600160a01b031614612a3f5760405162461bcd60e51b815260206004820152601060248201526f2737ba1037b33332b91030baba3437b960811b6044820152606401610e9d565b600154600160a01b900460ff1615612a695760405162461bcd60e51b8152600401610e9d90614c75565b6000838152601e6020526040812054601d80549091908110612a9b57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a08201529050612b0984614135565b612b1b81608001518260200151614215565b8060a001516001600160a01b031681608001516001600160a01b0316857fefff2c2e771e22be6fbe05d036f7f4425e0ae89221164a031d541fc9c1a7997a8460200151601454604051612b78929190918252602082015260400190565b60405180910390a450505050565b6000818152601f6020526040902054819060ff16612bb65760405162461bcd60e51b8152600401610e9d90614c47565b6000828152601e6020526040902054601d805484923392918110612bea57634e487b7160e01b600052603260045260246000fd5b60009182526020909120600560069092020101546001600160a01b031614612c485760405162461bcd60e51b81526020600482015260116024820152704f66666572206e6f7420666f7220796f7560781b6044820152606401610e9d565b600154600160a01b900460ff1615612c725760405162461bcd60e51b8152600401610e9d90614c75565b6000838152601e6020526040812054601d80549091908110612ca457634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a08201529050612d12846139b7565b612d2481608001518260200151613af7565b508060a001516001600160a01b031681608001516001600160a01b0316857f574b1ae7973930545c1df5e157af4a70774c2b940d7e877d4a95c25a5a36729f8460200151601454604051612b78929190918252602082015260400190565b601d8181548110612d9257600080fd5b6000918252602090912060069091020180546001820154600283015460038401546004850154600590950154939550919390926001600160a01b03918216911686565b6000818152601f60205260408120548190819081908190819060ff16612e3d5760405162461bcd60e51b815260206004820152601960248201527f546f6b656e20646f6573206e6f742068617665206f66666572000000000000006044820152606401610e9d565b6000878152601e6020526040812054601d80549091908110612e6f57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c08101825260069390930290910180548084526001820154948401859052600282015492840183905260038201546060850181905260048301546001600160a01b03908116608087018190526005909401541660a0909501859052909d949c50919a509098509650945092505050565b6001546001600160a01b03163314612f195760405162461bcd60e51b8152600401610e9d90614c9f565b600c55565b6001546001600160a01b03163314612f485760405162461bcd60e51b8152600401610e9d90614c9f565b6002546040516331a9108f60e11b815260048101839052829130916001600160a01b0390911690636352211e9060240160206040518083038186803b158015612f9057600080fd5b505afa158015612fa4573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612fc89190614a12565b6001600160a01b0316148015612fec575060008181526013602052604090205460ff165b6130085760405162461bcd60e51b8152600401610e9d90614d0b565b60008281526012602052604081205460118054909190811061303a57634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059093029091018054835260018101549383019390935260028301549082015260038201546001600160a01b0390811660608301526004909201549091166080820152905061309e83614050565b6130ac816060015184614059565b6040810151156130c8576130c881606001518260400151614215565b6060810151602080830151600b5460408051928352928201526000926001600160a01b03169186917fc48099946e05dc42cc979ec7a41a97ca9b3a5df3a99a84015dc7a5ac152560fd91016122b1565b60606000613124614307565b90506000613133858584613816565b905060008167ffffffffffffffff81111561315e57634e487b7160e01b600052604160045260246000fd5b604051908082528060200260200182016040528015613187578160200160208202803683370190505b5090506000865b6131988489614d7d565b81101561321d57601181815481106131c057634e487b7160e01b600052603260045260246000fd5b9060005260206000209060050201600001548383815181106131f257634e487b7160e01b600052603260045260246000fd5b60209081029190910101528161320781614deb565b925050808061321590614deb565b91505061318e565b50909695505050505050565b6002600054141561324c5760405162461bcd60e51b8152600401610e9d90614cd4565b6002600055600154600160a01b900460ff161561327b5760405162461bcd60e51b8152600401610e9d90614c75565b6000818152601f6020526040902054819060ff166132ab5760405162461bcd60e51b8152600401610e9d90614c47565b6000828152601e6020526040902054601d8054849233929181106132df57634e487b7160e01b600052603260045260246000fd5b60009182526020909120600560069092020101546001600160a01b03161461333d5760405162461bcd60e51b81526020600482015260116024820152704f66666572206e6f7420666f7220796f7560781b6044820152606401610e9d565b8233613348826138c9565b6001600160a01b03161461338a5760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610e9d565b6000848152601e6020526040812054601d805490919081106133bc57634e487b7160e01b600052603260045260246000fd5b600091825260208083206040805160c0810182526006909402909101805484526001810154848401526002810154848301526003810154606085015260048101546001600160a01b0390811660808601526005909101541660a084015288845260139091529091205490915060ff16801561343a5761343a86614317565b61344386614135565b6000806000613455856020015161413e565b9250925092506134898560a0015182848689602001516134759190614dd4565b61347f9190614dd4565b61224f9190614dd4565b613492826141a1565b61349b816141db565b82600760008282546134ad9190614d7d565b909155505083156134cb576134c685608001518a614059565b613543565b60025460a08601516080870151604051632142170760e11b81526001600160a01b0392831660048201529082166024820152604481018c90529116906342842e0e90606401600060405180830381600087803b15801561352a57600080fd5b505af115801561353e573d6000803e3d6000fd5b505050505b60a0808601516080808801516020808a01516014546040805192835292820152908101889052606081018790529182018590526001600160a01b03928316939216918c917ff708c3376411292d95041cd2743c377f471094e4fbdb253219be35528a271733910160405180910390a45050600160005550505050505050565b6001600160a01b0383166000908152601960205260408120546060916135e9858584613816565b905060008167ffffffffffffffff81111561361457634e487b7160e01b600052604160045260246000fd5b60405190808252806020026020018201604052801561363d578160200160208202803683370190505b5090506000865b61364e8489614d7d565b811015610e66576001600160a01b0389166000908152601760209081526040808320848452825280832054808452601f9092529091205460ff16156136bb57808484815181106136ae57634e487b7160e01b600052603260045260246000fd5b6020026020010181815250505b826136c581614deb565b9350505080806136d490614deb565b915050613644565b60155481101561373d5760405162461bcd60e51b815260206004820152602660248201527f50726963652062656c6f77206d61726b6574206d696e696d756d206f6666657260448201526520707269636560d01b6064820152608401610e9d565b33600090815260166020526040902055565b6001546001600160a01b031633146137795760405162461bcd60e51b8152600401610e9d90614c9f565b601555565b6001546001600160a01b031633146137a85760405162461bcd60e51b8152600401610e9d90614c9f565b6001600160a01b03811661380d5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b6064820152608401610e9d565b611c8081614250565b60008083116138585760405162461bcd60e51b815260206004820152600e60248201526d57726f6e67207061676553697a6560901b6044820152606401610e9d565b8184111561389a5760405162461bcd60e51b815260206004820152600f60248201526e4f666673657420746f206c6172676560881b6044820152606401610e9d565b6000826138a78587614d7d565b11156138be576138b78584614dd4565b90506138c1565b50825b949350505050565b60008181526013602052604081205460ff16156139355760008281526012602052604090205460118054909190811061391257634e487b7160e01b600052603260045260246000fd5b60009182526020909120600360059092020101546001600160a01b031692915050565b6002546040516331a9108f60e11b8152600481018490526001600160a01b0390911690636352211e9060240160206040518083038186803b15801561397957600080fd5b505afa15801561398d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906139b19190614a12565b92915050565b6000818152601e6020526040812054601d805490919081106139e957634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c081018252600690930290910180548084526001820154948401949094526002810154918301919091526003810154606083015260048101546001600160a01b03908116608084018190526005909201541660a0830152909250613a5c91614417565b613a6e8160a0015182600001516144c2565b8051613a799061456d565b60808101516001600160a01b03166000908152601960205260408120805460019290613aa6908490614dd4565b909155505060a08101516001600160a01b03166000908152601c60205260408120805460019290613ad8908490614dd4565b9091555050516000908152601f60205260409020805460ff1916905550565b6003546040516001600160a01b0384811660248301526000928392911690849060440160408051601f198184030181529181526020820180516001600160e01b0316632a4a1a9b60e01b17905251613b4f9190614bd6565b60006040518083038185875af1925050503d8060008114613b8c576040519150601f19603f3d011682016040523d82523d6000602084013e613b91565b606091505b5050905080613be25760405162461bcd60e51b815260206004820152601860248201527f436c61696d61626c652066756e6473206e6f742073656e7400000000000000006044820152606401610e9d565b9392505050565b601d80546000868152601e60209081526040808320849055805160c08101825289815280830187815260145482840190815242606084019081526001600160a01b038c8116608086018181528d831660a088019081526001808d018e559c8b5296517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc146134f6006909c029b8c015594517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc14613508b015592517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc14613518a015590517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc146135289015591517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc1461353880180546001600160a01b031990811692851692909217905592517f6d4407e7be21f808e6509aa9fa9143369579dd7d760fe20a2c09680fc1461354909701805490931696909116959095179055838352601782528083206019808452828520805486529184528285208b905581548b86526018855292852083905594845293909152613d98908490614d7d565b90915550506001600160a01b0382166000818152601a60209081526040808320601c808452828520805486529184528285208a905581548a8652601b8552928520839055948452939091526001929190613df3908490614d7d565b90915550505060009283525050601f60205260409020805460ff19166001179055565b6040805160a0810182528381526020808201848152600b548385019081526001600160a01b03808a1660608601908152898216608087019081526011805460008c81526012909852988720899055600189018155909552855160059097027f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c6881019790975592517f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c6987015590517f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c6a86015590517f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c6b850180549183166001600160a01b031992831617905591517f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c6c9094018054949091169390911692909217909155613f65600a80546001019055565b6001600160a01b0385166000818152600e602090815260408083206010808452828520805486529184528285208990558154898652600f8552928520839055948452939091526001929190613fbb908490614d7d565b909155505050600091825250601360205260409020805460ff191660011790555050565b6002546040516323b872dd60e01b81526001600160a01b03848116600483015230602483015260448201849052909116906323b872dd906064015b600060405180830381600087803b15801561403457600080fd5b505af1158015614048573d6000803e3d6000fd5b505050505050565b611c8081614317565b600254604051632142170760e11b81523060048201526001600160a01b03848116602483015260448201849052909116906342842e0e9060640161401a565b600154600160a01b900460ff166140e85760405162461bcd60e51b815260206004820152601460248201527314185d5cd8589b194e881b9bdd081c185d5cd95960621b6044820152606401610e9d565b6001805460ff60a01b191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b611c80816139b7565b6000806000612710600454856141549190614db5565b61415e9190614d95565b6127106005548661416f9190614db5565b6141799190614d95565b6127106006548761418a9190614db5565b6141949190614d95565b9250925092509193909250565b6009546040516001600160a01b039091169082156108fc029083906000818181858888f19350505050158015610f30573d6000803e3d6000fd5b6008546040516001600160a01b039091169082156108fc029083906000818181858888f19350505050158015610f30573d6000803e3d6000fd5b6040516001600160a01b0383169082156108fc029083906000818181858888f1935050505015801561424b573d6000803e3d6000fd5b505050565b600180546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b600154600160a01b900460ff16156142cc5760405162461bcd60e51b8152600401610e9d90614c75565b6001805460ff60a01b1916600160a01b1790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586141183390565b6000614312600a5490565b905090565b60008181526012602052604081205460118054909190811061434957634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059093029091018054835260018101549383019390935260028301549082015260038201546001600160a01b039081166060830152600490920154909116608082015290506143ae600a61473e565b6143c081606001518260000151614795565b80516143cb90614840565b60608101516001600160a01b031660009081526010602052604081208054600192906143f8908490614dd4565b9091555050516000908152601360205260409020805460ff1916905550565b6001600160a01b03821660009081526019602052604081205461443c90600190614dd4565b60008381526018602052604090205490915080821461448f576001600160a01b03841660009081526017602090815260408083208584528252808320548484528184208190558352601890915290208190555b5060009182526018602090815260408084208490556001600160a01b039094168352601781528383209183525290812055565b6001600160a01b0382166000908152601c60205260408120546144e790600190614dd4565b6000838152601b602052604090205490915080821461453a576001600160a01b0384166000908152601a602090815260408083208584528252808320548484528184208190558352601b90915290208190555b506000918252601b602090815260408084208490556001600160a01b039094168352601a81528383209183525290812055565b601d5460009061457f90600190614dd4565b6000838152601e6020526040812054601d80549394509092849081106145b557634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160c0810182526006909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546001600160a01b03908116608083015260059092015490911660a0820152601d805491925082918490811061463f57634e487b7160e01b600052603260045260246000fd5b6000918252602080832084516006939093020191825583810151600183015560408085015160028401556060850151600384015560808501516004840180546001600160a01b03199081166001600160a01b039384161790915560a0909601516005909401805490961693169290921790935583518252601e90925281812084905585815290812055601d8054806146e757634e487b7160e01b600052603160045260246000fd5b600082815260208120600660001990930192830201818155600181018290556002810182905560038101919091556004810180546001600160a01b0319908116909155600590910180549091169055905550505050565b80548061478d5760405162461bcd60e51b815260206004820152601b60248201527f436f756e7465723a2064656372656d656e74206f766572666c6f7700000000006044820152606401610e9d565b600019019055565b6001600160a01b0382166000908152601060205260408120546147ba90600190614dd4565b6000838152600f602052604090205490915080821461480d576001600160a01b0384166000908152600e602090815260408083208584528252808320548484528184208190558352600f90915290208190555b506000918252600f602090815260408084208490556001600160a01b039094168352600e81528383209183525290812055565b60115460009061485290600190614dd4565b6000838152601260205260408120546011805493945090928490811061488857634e487b7160e01b600052603260045260246000fd5b60009182526020918290206040805160a08101825260059093029091018054835260018101549383019390935260028301549082015260038201546001600160a01b03908116606083015260049092015490911660808201526011805491925082918490811061490857634e487b7160e01b600052603260045260246000fd5b60009182526020808320845160059390930201918255838101516001830155604080850151600284015560608501516003840180546001600160a01b03199081166001600160a01b0393841617909155608090960151600490940180549096169316929092179093558351825260129092528181208490558581529081205560118054806149a657634e487b7160e01b600052603160045260246000fd5b6000828152602081206005600019909301928302018181556001810182905560028101919091556003810180546001600160a01b0319908116909155600490910180549091169055905550505050565b600060208284031215614a07578081fd5b8135613be281614e32565b600060208284031215614a23578081fd5b8151613be281614e32565b60008060408385031215614a40578081fd5b8235614a4b81614e32565b946020939093013593505050565b600080600060608486031215614a6d578081fd5b8335614a7881614e32565b95602085013595506040909401359392505050565b60006020808385031215614a9f578182fd5b823567ffffffffffffffff80821115614ab6578384fd5b818501915085601f830112614ac9578384fd5b813581811115614adb57614adb614e1c565b8060051b604051601f19603f83011681018181108582111715614b0057614b00614e1c565b604052828152858101935084860182860187018a1015614b1e578788fd5b8795505b83861015614b40578035855260019590950194938601938601614b22565b5098975050505050505050565b600060208284031215614b5e578081fd5b5035919050565b600060208284031215614b76578081fd5b5051919050565b60008060408385031215614b8f578182fd5b50508035926020909101359150565b600080600060608486031215614bb2578283fd5b83359250602084013591506040840135614bcb81614e32565b809150509250925092565b60008251815b81811015614bf65760208186018101518583015201614bdc565b81811115614c045782828501525b509190910192915050565b6020808252825182820181905260009190848201906040850190845b8181101561321d57835183529284019291840191600101614c2b565b60208082526014908201527313d999995c88191bd95cc81b9bdd08195e1a5cdd60621b604082015260600190565b60208082526010908201526f14185d5cd8589b194e881c185d5cd95960821b604082015260600190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b6020808252601f908201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c00604082015260600190565b60208082526010908201526f151bdad95b881b9bdd081b1a5cdd195960821b604082015260600190565b60208082526028908201527f507269636520736d616c6c6572207468616e206d696e696d756d206c697374696040820152676e6720707269636560c01b606082015260800190565b60008219821115614d9057614d90614e06565b500190565b600082614db057634e487b7160e01b81526012600452602481fd5b500490565b6000816000190483118215151615614dcf57614dcf614e06565b500290565b600082821015614de657614de6614e06565b500390565b6000600019821415614dff57614dff614e06565b5060010190565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b0381168114611c8057600080fdfea2646970667358221220f240165657d2268b5648bee5cba7bd3810cf1fec70d3e57de7fc774ccc4972dc64736f6c63430008040033';

		let code: string;

		try {
			code = await web3.eth.getCode(addr, 'latest');
		} catch (err: any) {
			assert.fail(`Unexpected error: ${err}`);
		}
		expect(code).to.eql(expectedCode);

		try {
			code = await web3.eth.getCode(addr);
		} catch (err: any) {
			assert.fail(`Unexpected error: ${err}`);
		}
		expect(code).to.eql(expectedCode);
	})
})